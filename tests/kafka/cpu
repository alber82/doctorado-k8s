First = from(bucket: "doctorado")
  |> range(start: -20m)
  |> filter(fn: (r) => r["_measurement"] == "prometheus_remote_write")
  |> filter(fn: (r) => r["_field"] == "node_cpu_seconds_total")
  |> filter(fn: (r) => r["mode"] == "user")
  |> group(columns: [ "instance","mode"], mode:"by")
  |> keep(columns: ["instance","mode", "_value"])
  |> first()
  |> sum()

Last = from(bucket: "doctorado")
  |> range(start: -20m)
  |> filter(fn: (r) => r["_measurement"] == "prometheus_remote_write")
  |> filter(fn: (r) => r["_field"] == "node_cpu_seconds_total")
  |> filter(fn: (r) => r["mode"] == "user")
  |> group(columns: [ "instance","mode"], mode:"by")
  |> keep(columns: ["instance","mode", "_value"])
  |> last()
  |> sum()

union(tables: [Last, First])
|> difference()
