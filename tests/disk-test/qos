¿Qué hace esta consulta?
Agrupa los datos por nodo (node es una etiqueta que tú mismo inyectas con Telegraf).
Calcula la diferencia de solicitudes entre intervalos de 1 minuto (aggregateWindow + derivative).
Mide el throughput como peticiones por segundo (RPS) por nodo.

ESTO SE DEBE GENERAR
influx query  'import "math"
First = from(bucket: "doctorado")
  |> range(start: -15m, stop: now())
  |> filter(fn: (r) => r["_measurement"] == "diskio")
  |> filter(fn: (r) => r["name"] == "sda2")
  |> filter(fn: (r) => r["_field"] == "read_time")
  |> group(columns: ["node_ip"], mode:"by")
  |> keep(columns: ["node_ip", "_value"])
  |> first()

Last = from(bucket: "doctorado")
  |> range(start: -15m, stop: now())
  |> filter(fn: (r) => r["_measurement"] == "diskio")
  |> filter(fn: (r) => r["name"] == "sda2")
  |> filter(fn: (r) => r["_field"] == "read_time")
  |> group(columns: [ "node_ip"], mode:"by")
  |> keep(columns: ["node_ip", "_value"])
  |> last()

union(tables: [ First, Last])
|> difference()
|> map(fn: (r) => ({r with  _value: math.abs(x: float(v: r._value))}))'




 influx query 'from(bucket: "doctorado")
  |> range(start: -105m, stop: -5m)
  |> filter(fn: (r) => r["_measurement"] == "diskio")
  |> filter(fn: (r) => r["_field"] == "read_time")
  |> filter(fn: (r) => r["name"] == "sda2" )
  |> aggregateWindow(every: 3m, fn: max, createEmpty: false)
    |> derivative(unit: 1s, nonNegative: true)
    |> group(columns: ["node"])
    |> rename(columns: {_value: "average_read_time_per_node"})
    |> filter(fn: (r) => r.average_read_time_per_node != 0)
    |> keep(columns: ["_time", "node", "average_read_time_per_node"])'

 influx query 'from(bucket: "doctorado")
  |> range(start: -115m, stop: -15m)
  |> filter(fn: (r) => r["_measurement"] == "diskio")
  |> filter(fn: (r) => r["_field"] == "write_time")
  |> filter(fn: (r) => r["name"] == "sda2" )
  |> aggregateWindow(every: 3m, fn: max, createEmpty: false)
    |> derivative(unit: 1s, nonNegative: true)
    |> group(columns: ["node"])
    |> rename(columns: {_value: "average_write_time_per_node"})
    |> filter(fn: (r) => r.average_write_time_per_node != 0)
    |> keep(columns: ["_time", "node", "average_write_time_per_node"])'



RANDOM

k get pods -n nginx -o wide

NAME                           READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
disk-stress-57f64f5755-5sqjv   2/2     Running   0          2m15s   10.0.4.88    worker04   <none>           <none>
disk-stress-57f64f5755-76g88   2/2     Running   0          47m     10.0.1.254   worker01   <none>           <none>
disk-stress-57f64f5755-9bcvz   2/2     Running   0          72m     10.0.3.122   worker03   <none>           <none>
disk-stress-57f64f5755-9n4jc   2/2     Running   0          77m     10.0.2.17    worker02   <none>           <none>
disk-stress-57f64f5755-9ppkj   2/2     Running   0          37m     10.0.2.126   worker02   <none>           <none>
disk-stress-57f64f5755-c8hcf   2/2     Running   0          67m     10.0.1.108   worker01   <none>           <none>
disk-stress-57f64f5755-cs2w5   2/2     Running   0          52m     10.0.2.16    worker02   <none>           <none>
disk-stress-57f64f5755-f8xrr   2/2     Running   0          87m     10.0.1.124   worker01   <none>           <none>
disk-stress-57f64f5755-gxxgg   2/2     Running   0          62m     10.0.4.136   worker04   <none>           <none>
disk-stress-57f64f5755-h5wkq   2/2     Running   0          162m    10.0.2.94    worker02   <none>           <none>
disk-stress-57f64f5755-nm58x   2/2     Running   0          12m     10.0.2.138   worker02   <none>           <none>
disk-stress-57f64f5755-pkzgq   2/2     Running   0          17m     10.0.3.79    worker03   <none>           <none>
disk-stress-57f64f5755-q7fkv   2/2     Running   0          27m     10.0.1.57    worker01   <none>           <none>
disk-stress-57f64f5755-qfj2t   2/2     Running   0          57m     10.0.3.17    worker03   <none>           <none>
disk-stress-57f64f5755-qvl47   2/2     Running   0          82m     10.0.4.233   worker04   <none>           <none>
disk-stress-57f64f5755-rqclr   2/2     Running   0          22m     10.0.4.209   worker04   <none>           <none>
disk-stress-57f64f5755-wdd7f   2/2     Running   0          92m     10.0.3.220   worker03   <none>           <none>
disk-stress-57f64f5755-xd5d2   2/2     Running   0          7m16s   10.0.1.253   worker01   <none>           <none>
disk-stress-57f64f5755-xrf4v   2/2     Running   0          32m     10.0.3.165   worker03   <none>           <none>
disk-stress-57f64f5755-z2c7m   2/2     Running   0          42m     10.0.4.56    worker04   <none>           <none>


k top nodes


k top pods -n nginx

master

  Resource           Requests    Limits
  --------           --------    ------
  cpu                300m (7%)   200m (5%)
  memory             188Mi (2%)  228Mi (2%)

w1
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1450m (36%)      1250m (31%)
  memory             1331920Ki (16%)  1424080Ki (17%)


w2

  Resource           Requests         Limits
  --------           --------         ------
  cpu                1350m (33%)      1250m (31%)
  memory             1260240Ki (15%)  1280M (15%)


w3
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1350m (33%)      1250m (31%)
  memory             1260240Ki (15%)  1280M (15%)

w4

  Resource           Requests         Limits
  --------           --------         ------
  cpu                1360m (34%)      1750m (43%)
  memory             1325776Ki (32%)  1414217728 (33%)



average_write_time_per_node




average_read_time_per_node














----------------------------------------------------------



K8s


NAME       CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)
master01   2747m        68%      4258Mi          53%
worker01   452m         11%      1295Mi          16%
worker02   1031m        25%      1443Mi          18%
worker03   767m         19%      1197Mi          15%
worker04   682m         17%      1492Mi          37%
worker05   4001m        100%     1309Mi          16%

  k get pods -n nginx -o wide





NAME                           READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
disk-stress-57f64f5755-5sqjv   2/2     Running   0          2m15s   10.0.4.88    worker04   <none>           <none>
disk-stress-57f64f5755-76g88   2/2     Running   0          47m     10.0.1.254   worker01   <none>           <none>
disk-stress-57f64f5755-9bcvz   2/2     Running   0          72m     10.0.3.122   worker03   <none>           <none>
disk-stress-57f64f5755-9n4jc   2/2     Running   0          77m     10.0.2.17    worker02   <none>           <none>
disk-stress-57f64f5755-9ppkj   2/2     Running   0          37m     10.0.2.126   worker02   <none>           <none>
disk-stress-57f64f5755-c8hcf   2/2     Running   0          67m     10.0.1.108   worker01   <none>           <none>
disk-stress-57f64f5755-cs2w5   2/2     Running   0          52m     10.0.2.16    worker02   <none>           <none>
disk-stress-57f64f5755-f8xrr   2/2     Running   0          87m     10.0.1.124   worker01   <none>           <none>
disk-stress-57f64f5755-gxxgg   2/2     Running   0          62m     10.0.4.136   worker04   <none>           <none>
disk-stress-57f64f5755-h5wkq   2/2     Running   0          162m    10.0.2.94    worker02   <none>           <none>
disk-stress-57f64f5755-nm58x   2/2     Running   0          12m     10.0.2.138   worker02   <none>           <none>
disk-stress-57f64f5755-pkzgq   2/2     Running   0          17m     10.0.3.79    worker03   <none>           <none>
disk-stress-57f64f5755-q7fkv   2/2     Running   0          27m     10.0.1.57    worker01   <none>           <none>
disk-stress-57f64f5755-qfj2t   2/2     Running   0          57m     10.0.3.17    worker03   <none>           <none>
disk-stress-57f64f5755-qvl47   2/2     Running   0          82m     10.0.4.233   worker04   <none>           <none>
disk-stress-57f64f5755-rqclr   2/2     Running   0          22m     10.0.4.209   worker04   <none>           <none>
disk-stress-57f64f5755-wdd7f   2/2     Running   0          92m     10.0.3.220   worker03   <none>           <none>
disk-stress-57f64f5755-xd5d2   2/2     Running   0          7m16s   10.0.1.253   worker01   <none>           <none>
disk-stress-57f64f5755-xrf4v   2/2     Running   0          32m     10.0.3.165   worker03   <none>           <none>
disk-stress-57f64f5755-z2c7m   2/2     Running   0          42m     10.0.4.56    worker04   <none>           <none>


master

  Resource           Requests    Limits
  --------           --------    ------
  cpu                300m (7%)   200m (5%)
  memory             188Mi (2%)  228Mi (2%)

w1
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1450m (36%)      1250m (31%)
  memory             1331920Ki (16%)  1424080Ki (17%)


w2

  Resource           Requests         Limits
  --------           --------         ------
  cpu                1350m (33%)      1250m (31%)
  memory             1260240Ki (15%)  1280M (15%)


w3
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1350m (33%)      1250m (31%)
  memory             1260240Ki (15%)  1280M (15%)

w4

  Resource           Requests         Limits
  --------           --------         ------
  cpu                1360m (34%)      1750m (43%)
  memory             1325776Ki (32%)  1414217728 (33%)



average_write_time_per_node




average_read_time_per_node










CHRONOS


NAME       CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)
master01   2677m        66%      3820Mi          48%
worker01   1524m        38%      1309Mi          16%
worker02   1527m        38%      1462Mi          18%
worker03   1922m        48%      1272Mi          16%
worker04   1656m        41%      1370Mi          34%
worker05   2035m        50%      1215Mi          15%


NAME                           READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
disk-stress-57f64f5755-5sqjv   2/2     Running   0          2m15s   10.0.4.88    worker04   <none>           <none>
disk-stress-57f64f5755-76g88   2/2     Running   0          47m     10.0.1.254   worker01   <none>           <none>
disk-stress-57f64f5755-9bcvz   2/2     Running   0          72m     10.0.3.122   worker03   <none>           <none>
disk-stress-57f64f5755-9n4jc   2/2     Running   0          77m     10.0.2.17    worker02   <none>           <none>
disk-stress-57f64f5755-9ppkj   2/2     Running   0          37m     10.0.2.126   worker02   <none>           <none>
disk-stress-57f64f5755-c8hcf   2/2     Running   0          67m     10.0.1.108   worker01   <none>           <none>
disk-stress-57f64f5755-cs2w5   2/2     Running   0          52m     10.0.2.16    worker02   <none>           <none>
disk-stress-57f64f5755-f8xrr   2/2     Running   0          87m     10.0.1.124   worker01   <none>           <none>
disk-stress-57f64f5755-gxxgg   2/2     Running   0          62m     10.0.4.136   worker04   <none>           <none>
disk-stress-57f64f5755-h5wkq   2/2     Running   0          162m    10.0.2.94    worker02   <none>           <none>
disk-stress-57f64f5755-nm58x   2/2     Running   0          12m     10.0.2.138   worker02   <none>           <none>
disk-stress-57f64f5755-pkzgq   2/2     Running   0          17m     10.0.3.79    worker03   <none>           <none>
disk-stress-57f64f5755-q7fkv   2/2     Running   0          27m     10.0.1.57    worker01   <none>           <none>
disk-stress-57f64f5755-qfj2t   2/2     Running   0          57m     10.0.3.17    worker03   <none>           <none>
disk-stress-57f64f5755-qvl47   2/2     Running   0          82m     10.0.4.233   worker04   <none>           <none>
disk-stress-57f64f5755-rqclr   2/2     Running   0          22m     10.0.4.209   worker04   <none>           <none>
disk-stress-57f64f5755-wdd7f   2/2     Running   0          92m     10.0.3.220   worker03   <none>           <none>
disk-stress-57f64f5755-xd5d2   2/2     Running   0          7m16s   10.0.1.253   worker01   <none>           <none>
disk-stress-57f64f5755-xrf4v   2/2     Running   0          32m     10.0.3.165   worker03   <none>           <none>
disk-stress-57f64f5755-z2c7m   2/2     Running   0          42m     10.0.4.56    worker04   <none>           <none>


master

  Resource           Requests    Limits
  --------           --------    ------
  cpu                300m (7%)   200m (5%)
  memory             188Mi (2%)  228Mi (2%)

w1
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1450m (36%)      1250m (31%)
  memory             1331920Ki (16%)  1424080Ki (17%)


w2

  Resource           Requests         Limits
  --------           --------         ------
  cpu                1350m (33%)      1250m (31%)
  memory             1260240Ki (15%)  1280M (15%)


w3
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1350m (33%)      1250m (31%)
  memory             1260240Ki (15%)  1280M (15%)

w4

  Resource           Requests         Limits
  --------           --------         ------
  cpu                1360m (34%)      1750m (43%)
  memory             1325776Ki (32%)  1414217728 (33%)



average_write_time_per_node




average_read_time_per_node
